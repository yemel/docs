# ERC721 Contracts

## Overview

The ERC721 repository contains Decentraland's implementation of the ERC721 standard for non-fungible tokens. This forms the foundation for all NFT assets in the Decentraland ecosystem, including LAND parcels, Estates, and other collectibles.

## Core Contracts

### ERC721Base

**Purpose**: Core implementation of the ERC721 standard with basic NFT functionality.

**Key Specifications**:
- Implements standard ERC721 interface for NFT ownership and transfers
- Provides safe transfer mechanisms to prevent token loss
- Manages token approvals for third-party operators
- Tracks token ownership through internal mappings
- Implements balance tracking for each address

**Main Functions**:
- `transferFrom`: Transfer tokens between addresses
- `safeTransferFrom`: Transfer with recipient validation
- `approve`: Grant permission to transfer specific token
- `setApprovalForAll`: Grant operator permissions for all tokens
- `balanceOf`: Query token balance of an address
- `ownerOf`: Retrieve owner of specific token

### FullAssetRegistry

**Purpose**: Complete asset registry combining base ERC721 with enumerable and metadata extensions.

**Key Specifications**:
- Extends ERC721Base with full feature set
- Provides complete token enumeration capabilities
- Integrates metadata management for token properties
- Implements comprehensive storage patterns
- Supports complex queries and iterations

**Integration Features**:
- Combines multiple ERC721 extensions
- Provides unified interface for all NFT operations
- Optimized storage for gas efficiency
- Backwards compatible with standard ERC721

### ERC721Enumerable

**Purpose**: Extension providing enumeration capabilities for token discovery and iteration.

**Key Specifications**:
- Enables iteration through all tokens in existence
- Provides token enumeration by owner
- Implements total supply tracking
- Supports token discovery by index
- Maintains ordered lists of tokens

**Main Functions**:
- `totalSupply`: Get total number of tokens in existence
- `tokenByIndex`: Retrieve token ID by global index
- `tokenOfOwnerByIndex`: Get token ID by owner and index
- Enables marketplace and wallet integrations
- Supports batch operations and queries

### ERC721Metadata

**Purpose**: Metadata extension for associating descriptive information with tokens.

**Key Specifications**:
- Implements name and symbol for token collection
- Provides URI management for token metadata
- Supports off-chain metadata storage patterns
- Enables rich token descriptions and properties
- Integrates with metadata standards (OpenSea, etc.)

**Metadata Features**:
- `name`: Collection name identifier
- `symbol`: Short symbol for collection
- `tokenURI`: Unique metadata URI per token
- Supports IPFS and HTTP metadata hosting
- Enables dynamic metadata updates

### AssetRegistryStorage

**Purpose**: Dedicated storage contract for optimized data management.

**Key Specifications**:
- Separates storage logic from business logic
- Implements efficient storage patterns
- Reduces gas costs through optimization
- Provides upgrade-safe storage structure
- Manages complex data relationships

**Storage Patterns**:
- Owner to token mappings
- Token to owner mappings
- Approval tracking structures
- Enumeration data structures
- Metadata storage references

## Interface Contracts

### IERC721Base

**Purpose**: Standard interface definition for ERC721 base functionality.

**Key Specifications**:
- Defines required functions for ERC721 compliance
- Specifies event signatures for transfers and approvals
- Provides type definitions for implementation
- Ensures interoperability with other contracts

### IERC721Enumerable

**Purpose**: Interface for enumerable extension functionality.

**Key Specifications**:
- Defines enumeration-specific functions
- Specifies additional query capabilities
- Extends base ERC721 interface
- Enables advanced token discovery

### IERC721Metadata

**Purpose**: Interface for metadata extension functionality.

**Key Specifications**:
- Defines metadata-related functions
- Specifies URI and description methods
- Extends base ERC721 interface
- Standardizes metadata access patterns

## Implementation Features

### Gas Optimization
- Efficient storage patterns to minimize gas costs
- Batch operation support where applicable
- Optimized data structures for common operations
- Reduced storage slots through packing

### Security Measures
- Safe transfer validation to prevent token loss
- Reentrancy guards on critical functions
- Access control for administrative functions
- Input validation and sanitization

### Upgradeability Support
- Storage separation for upgrade compatibility
- Proxy-friendly architecture
- Preserved storage layout patterns
- Migration support capabilities

## Use Cases

### LAND Tokens
- Represents virtual land parcels in Decentraland
- Each token corresponds to specific coordinates
- Integrates with Estate system for grouping
- Supports metadata for parcel content

### Estate Tokens
- Groups multiple LAND parcels under single ownership
- Enables bulk management of virtual property
- Maintains relationship with constituent LANDs
- Supports complex property structures

### General NFT Assets
- Foundation for any NFT in Decentraland ecosystem
- Extensible for new asset types
- Compatible with standard NFT infrastructure
- Supports marketplace and wallet integrations

## Integration Guidelines

### For Developers
- Inherit from appropriate base contract
- Implement required interface functions
- Follow storage patterns for consistency
- Use provided extensions for additional features

### For Marketplaces
- Query using enumerable interface
- Access metadata through standard methods
- Handle safe transfers appropriately
- Respect approval mechanisms

### For Wallets
- Display tokens using metadata
- Show ownership through balance queries
- Enable transfers via standard interface
- Support approval management